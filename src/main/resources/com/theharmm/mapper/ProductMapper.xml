<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.theharmm.mapper.ProductMapper">

	<!-- 키워드는 무조건 대문자 소문자 구분!!!! -->
	<sql id="criteria">
		<trim prefix=" AND (" suffix=")" prefixOverrides="AND">
			<foreach item="type" collection="cri.typeArr"> 
				<trim prefix="AND">
					<choose>					      
						<when test="type== 'B'.toString()">
							bname like '%' || #{cri.bkeyword} || '%'
						</when>
						<when test="type== 'C'.toString()">
							category = #{cri.ckeyword} 
						</when>
						<when test="type== 'S'.toString()">
							size like '%' || #{cri.ssize} || '%'
							and category = 1
						</when>
						<when test="type== 'L'.toString()">
							size like '%' || #{cri.lsize} || '%'
							and category = 2
						</when>
						<when test="type== 'P'.toString()">
						  <![CDATA[  
							pcprice >= #{cri.startp} and s_price < #{cri.endp}						
						    ]]>
						</when>
					</choose> <!-- end choose -->
				</trim><!--end trim OR -->
			</foreach> <!--foreach -->
		</trim> <!--end trim pre... -->
	</sql>

	<!--  제품 리스트 가져오기 -->
	<select id="selectProducts"
		resultType="com.theharmm.dto.product.ProductVo"
		parameterType="HashMap">
		select pid,category,brand,pname_e,pname_k,model_number,release_date
		,color,release_price,img1,img2,img3,img4,img5
		from resell_product
		<!-- <![CDATA[ where rownum <= 12 ]]> -->
	</select>

	<!--  제품 리스트 갯수 가져오기 -->
	<select id="countProducts" resultType="int"
		parameterType="HashMap">
        select count(distinct pid)
            from (
            	select pv.pid
            	from productVO_view pv, product_color pc
            	WHERE pv.pid = pc.pid
                AND depth1name = #{category.depth1name}
                AND depth2name LIKE '%'
                AND depth3name LIKE '%'
                <include refid="criteria"> </include>
                )
	</select>

</mapper>